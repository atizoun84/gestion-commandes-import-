<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B-one | Suivi paiement & Logistique</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#7d2ae8">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { 
            --canva-purple: #7d2ae8; 
            --canva-blue: #00c4cc; 
            --canva-gradient: linear-gradient(135deg, #7d2ae8 0%, #00c4cc 100%);
        }
        
        /* Adaptation plein √©cran */
        html, body { height: 100%; margin: 0; padding: 0; overflow-x: hidden; }
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; }
        
        /* Header & Navbar */
        .app-header { background: var(--canva-gradient); color: white; padding: 0.5rem 0; flex-shrink: 0; }
        .header-logo { height: 45px; width: 45px; object-fit: contain; border-radius: 10px; background: rgba(255,255,255,0.2); padding: 3px; }
        
        .navbar-dark .navbar-nav .nav-link { color: rgba(255,255,255,0.9) !important; font-weight: 500; font-size: 0.9rem; }
        .navbar-toggler { border: none; padding: 0; }
        .navbar-toggler:focus { box-shadow: none; }

        /* Contenu principal adaptatif */
        main { flex: 1 0 auto; width: 100%; max-width: 100%; }

        /* Barre de Recherche */
        .search-container { margin-top: -25px; position: relative; z-index: 10; width: 100%; }
        .search-input { 
            border-radius: 30px; border: none; padding: 15px 25px 15px 50px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); font-size: 1rem; width: 100%;
        }
        .search-icon { position: absolute; left: 20px; top: 15px; color: #888; font-size: 1.2rem; }

        /* Filtres Cat√©gories */
        .category-scroll { display: flex; overflow-x: auto; gap: 10px; padding: 15px 0; scrollbar-width: none; }
        .category-scroll::-webkit-scrollbar { display: none; }
        .cat-badge { 
            white-space: nowrap; padding: 8px 20px; border-radius: 20px; 
            background: white; color: #555; font-weight: 600; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid transparent;
        }
        .cat-badge.active { background: var(--canva-purple); color: white; }

        /* Grille Produits (Masqu√©e structurellement) */
        #productGrid { display: none; }

        /* Modal Raffin√©e & Formulaire */
        .modal-content { border-radius: 30px; border: none; overflow: hidden; }
        .modal-header-img { background: #f8f9fa; padding: 20px; text-align: center; }
        .modal-product-img-lg { max-height: 150px; object-fit: contain; }
        .form-label { font-weight: 600; color: #555; font-size: 0.85rem; }
        .form-control, .form-select { border-radius: 12px; border: 1px solid #eee; padding: 10px 15px; }
        .form-control:focus { border-color: var(--canva-purple); box-shadow: none; }
        .readonly-info { background-color: #f8f9fa; border-radius: 10px; padding: 8px 12px; margin-bottom: 10px; font-size: 0.9rem; border: 1px solid #eee; }

        .btn-validate-order { 
            background: var(--canva-gradient); color: white; border: none; 
            border-radius: 15px; padding: 12px; font-weight: 700; width: 100%;
            margin-top: 10px; box-shadow: 0 5px 15px rgba(125, 42, 232, 0.3);
        }

        /* Section Mes Commandes */
        .orders-section { background: white; border-radius: 25px; padding: 25px; margin-top: 40px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .clickable-order-row { cursor: pointer; transition: background 0.2s; border-bottom: 1px solid #f0f0f0; }
        .clickable-order-row:hover { background-color: #f8f9fa; }

        /* Publication Styles */
        .publish-header { border-bottom: 3px double #7d2ae8; padding-bottom: 10px; margin-bottom: 20px; }
        .publish-item { border-left: 4px solid #00c4cc; padding-left: 15px; margin-bottom: 15px; }
        .signature-area { margin-top: 30px; font-style: italic; border-top: 1px solid #eee; padding-top: 10px; }

        /* Logistics Styles */
        .logistics-step { border: 1px solid #eee; border-radius: 15px; padding: 10px; margin-bottom: 8px; transition: 0.3s; }
        .logistics-step.completed { background: #e6fcf5; border-color: #0ca678; }

        @media print {
            .no-print { display: none !important; }
            .modal-content { border: none !important; box-shadow: none !important; }
            body { background: white; }
        }
    </style>
</head>
<body>

<header class="app-header shadow-lg no-print">
    <nav class="navbar navbar-expand-lg navbar-dark container">
        <div class="container-fluid px-0">
            <a class="navbar-brand d-flex align-items-center gap-2" href="#">
                <img id="navLogo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="header-logo" alt="">
                <div>
                    <h1 class="h6 fw-bold mb-0 text-white" id="navCompanyName">B-one</h1>
                    <small class="opacity-75" style="font-size: 0.65rem;">Suivi paiement</small>
                </div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="index.html">Accueil</a></li>
                    <li class="nav-item"><a class="nav-link" href="produits.html">Produits</a></li>
                    <li class="nav-item"><a class="nav-link" href="panier.html">Panier</a></li>
                    <li class="nav-item"><a class="nav-link active" href="paiement.html">Suivi Paiements</a></li>
                    <li class="nav-item"><a class="nav-link" href="comptabilite.html">Comptabilit√©</a></li>
                    <li class="nav-item"><a class="nav-link" href="configuration.html">Configuration</a></li>
                    <li class="nav-item"><a class="nav-link" href="maintenance.html">Maintenance</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<main class="container px-4">
    <div class="search-container no-print">
        <i class="bi bi-search search-icon"></i>
        <input type="text" id="orderSearchInput" class="form-control search-input" placeholder="Rechercher par client..." onkeyup="Shop.renderOrders()">
    </div>

    <div class="mt-4 no-print">
        <label class="form-label fw-bold">Filtrer par Produit :</label>
        <select id="productFilter" class="form-select rounded-pill" onchange="Shop.renderOrders()">
            <option value="all">Tous les produits</option>
        </select>
    </div>

    <section class="orders-section" id="customerOrdersSection">
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
            <h2 class="h5 fw-bold mb-0"><i class="bi bi-wallet2 text-primary me-2"></i>Tableau de Bord</h2>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary btn-sm rounded-pill px-3 no-print" onclick="window.print()"><i class="bi bi-printer"></i></button>
                <button class="btn btn-dark rounded-pill px-4 fw-bold shadow-sm no-print" onclick="Shop.openPublishModal()">
                    <i class="bi bi-send-fill me-2 text-info"></i>PUBLIER
                </button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table align-middle">
                <thead class="table-light small">
                    <tr>
                        <th>Date</th>
                        <th>Client & Produit</th>
                        <th class="text-end">Reste √† Payer</th>
                        <th class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody id="customerOrdersTable" class="small"></tbody>
            </table>
        </div>
    </section>
</main>

<div class="modal fade" id="orderModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content shadow-lg">
            <div class="modal-header-img no-print">
                <button type="button" class="btn-close float-end" data-bs-dismiss="modal"></button>
                <img id="orderModalImg" src="" class="modal-product-img-lg mt-3">
                <div class="mt-2">
                    <h4 class="fw-bold text-dark mb-0" id="orderModalTitle"></h4>
                    <small id="displayClientName" class="text-muted"></small>
                </div>
            </div>
            <div class="modal-body p-4">
                <div class="row">
                    <div class="col-md-6 border-end">
                        <h6 class="fw-bold mb-3 text-primary border-bottom pb-2">PAIEMENT</h6>
                        <form id="directOrderForm">
                            <input type="hidden" id="editOrderId">
                            <div class="mb-2 d-flex justify-content-between align-items-center bg-light p-2 rounded">
                                <span class="small fw-bold">Vente: <span id="valBase">0</span></span>
                                <input class="form-check-input" type="checkbox" id="paidBaseCheck" onchange="Shop.updateTotalDisplay()">
                            </div>
                            <div class="mb-2 d-flex justify-content-between align-items-center bg-light p-2 rounded">
                                <span class="small fw-bold">Transit: <span id="valTransit">0</span></span>
                                <input class="form-check-input" type="checkbox" id="paidTransitCheck" onchange="Shop.updateTotalDisplay()">
                            </div>
                            <div class="mb-2 d-flex justify-content-between align-items-center bg-light p-2 rounded">
                                <span class="small fw-bold">Douane: <span id="valDouane">0</span></span>
                                <input class="form-check-input" type="checkbox" id="paidDouaneCheck" onchange="Shop.updateTotalDisplay()">
                            </div>
                            <div class="mb-2 d-flex justify-content-between align-items-center bg-light p-2 rounded">
                                <span class="small fw-bold">Livraison: <span id="valLivraison">0</span></span>
                                <input class="form-check-input" type="checkbox" id="paidLivraisonCheck" onchange="Shop.updateTotalDisplay()">
                            </div>
                            <div class="p-2 bg-dark text-white rounded-3 mb-3 text-center">
                                <small class="d-block opacity-75" style="font-size:0.7rem">RESTE √Ä PAYER</small>
                                <span class="h5 fw-bold" id="orderTotalDisplay">0 F CFA</span>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-6">
                        <h6 class="fw-bold mb-3 text-info border-bottom pb-2">LOGISTIQUE (<span id="originCountry">Origine</span>)</h6>
                        <div id="logisticsContainer">
                            <div class="logistics-step" id="step_orig">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="log_orig" onchange="Shop.updateStepStyle(this)">
                                    <label class="form-check-label small fw-bold" for="log_orig">Achat & R√©ception Origine</label>
                                </div>
                            </div>
                            <div class="logistics-step" id="step_ship">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="log_ship" onchange="Shop.updateStepStyle(this)">
                                    <label class="form-check-label small fw-bold" for="log_ship">Exp√©dition / Chargement</label>
                                </div>
                            </div>
                            <div class="logistics-step" id="step_transit">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="log_transit" onchange="Shop.updateStepStyle(this)">
                                    <label class="form-check-label small fw-bold" for="log_transit">Arriv√©e & Transit / Douane</label>
                                </div>
                            </div>
                            <div class="logistics-step" id="step_final">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="log_final" onchange="Shop.updateStepStyle(this)">
                                    <label class="form-check-label small fw-bold" for="log_final">Pr√™t pour Livraison / Retrait</label>
                                </div>
                            </div>
                            <div class="mt-2">
                                <label class="form-label" style="font-size:0.7rem">Date Prochaine √âtape :</label>
                                <input type="date" id="nextStepDate" class="form-control form-control-sm">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3 g-2 no-print">
                    <div class="col-6">
                        <button type="button" class="btn btn-primary w-100 rounded-pill fw-bold" onclick="Shop.submitDirectOrder()">
                            <i class="bi bi-save me-1"></i>Enregistrer
                        </button>
                    </div>
                    <div class="col-6">
                        <button type="button" class="btn btn-success w-100 rounded-pill fw-bold" onclick="Shop.shareOrderWA()">
                            <i class="bi bi-whatsapp me-1"></i>WhatsApp
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="publishModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg modal-fullscreen-sm-down">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header bg-dark text-white p-4">
                <h5 class="modal-title fw-bold"><i class="bi bi-file-earmark-text me-2"></i>BULLETIN OFFICIEL</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4 p-md-5 bg-white" id="publishContent">
                <div class="publish-header text-center">
                    <h2 class="h4 fw-bold text-uppercase" id="pubCompanyName">B-ONE GROUP</h2>
                    <p class="text-muted small mb-0">Rapport de Situation des Commandes</p>
                    <small class="text-muted" id="pubDate"></small>
                </div>
                <div id="publishOrdersList"></div>
                <div class="signature-area text-end">
                    <p class="mb-0 fw-bold">Le Pr√©sident Directeur G√©n√©ral,</p>
                    <p class="text-primary fw-bold" id="pubCEO">Atizoun Plateny AMOUSSOU</p>
                </div>
            </div>
            <div class="modal-footer bg-light p-3 no-print">
                <button class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">Fermer</button>
                <button class="btn btn-success rounded-pill px-4 shadow" onclick="Shop.copyAndShareWhatsApp()">
                    <i class="bi bi-whatsapp me-2"></i>Copier et Partager
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Logique PWA : Enregistrement du Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('PWA: Service Worker enregistr√© !'))
                .catch(err => console.error('PWA: Erreur d\'enregistrement SW:', err));
        });
    }

    const STORAGE_KEY = 'BONE_OFFICIAL_CONFIG_V2';
    const DB_KEY = 'BONE_PRODUCTS_LIST';
    const ORDERS_KEY = 'BONE_ORDERS_HISTORY';

    let products = JSON.parse(localStorage.getItem(DB_KEY)) || [];
    let userOrders = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
    let selectedOrder = null;
    let orderModalObj = null;
    let publishModalObj = null;

    const Shop = {
        init() {
            orderModalObj = new bootstrap.Modal(document.getElementById('orderModal'));
            publishModalObj = new bootstrap.Modal(document.getElementById('publishModal'));
            this.loadBranding();
            this.fillProductFilter();
            this.renderOrders();
        },

        loadBranding() {
            const config = JSON.parse(localStorage.getItem(STORAGE_KEY));
            if(config) {
                if(config.logo) document.getElementById('navLogo').src = config.logo;
                if(config.companyName) {
                    document.getElementById('navCompanyName').innerText = config.companyName;
                    document.getElementById('pubCompanyName').innerText = config.companyName;
                }
                if(config.ceoName) document.getElementById('pubCEO').innerText = config.ceoName;
            }
        },

        fillProductFilter() {
            const select = document.getElementById('productFilter');
            const uniqueProds = [...new Set(userOrders.map(o => o.prodName))];
            uniqueProds.forEach(name => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.textContent = name;
                select.appendChild(opt);
            });
        },

        renderOrders() {
            const query = document.getElementById('orderSearchInput').value.toLowerCase();
            const prodFilter = document.getElementById('productFilter').value;
            const table = document.getElementById('customerOrdersTable');
            
            const filteredOrders = userOrders.filter(o => {
                const matchClient = (o.client && o.client.toLowerCase().includes(query));
                const matchProd = (prodFilter === 'all' || o.prodName === prodFilter);
                return matchClient && matchProd;
            });
            
            if (filteredOrders.length === 0) {
                table.innerHTML = `<tr><td colspan="4" class="text-center text-muted py-4">Aucune donn√©e correspondante.</td></tr>`;
                return;
            }
            
            table.innerHTML = filteredOrders.map(o => {
                const vBase = parseFloat(o.price) || 0;
                const tPrice = parseFloat(o.transit) || 0;
                const dPrice = parseFloat(o.douane) || 0;
                const lPrice = parseFloat(o.livraison) || 0;
                let payed = 0;
                if(o.isPricePayed) payed += vBase;
                if(o.isTransitPayed) payed += tPrice;
                if(o.isDouanePayed) payed += dPrice;
                if(o.isLivraisonPayed) payed += lPrice;
                
                const reste = (vBase + tPrice + dPrice + lPrice) - payed;
                const dateDisp = o.timestamp ? new Date(o.timestamp).toLocaleDateString('fr-FR') : '-';

                return `
                <tr class="clickable-order-row" onclick="Shop.editOrder('${o.id}')">
                    <td><span class="text-muted">${dateDisp}</span></td>
                    <td>
                        <div class="fw-bold text-dark">${o.client || 'Client'}</div>
                        <div class="text-muted" style="font-size: 0.75rem;">${o.prodName || 'Produit'}</div>
                    </td>
                    <td class="text-end fw-bold text-danger">${reste.toLocaleString()} F</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-primary rounded-pill px-3">D√©tails</button>
                    </td>
                </tr>`;
            }).join('');
        },

        editOrder(orderId) {
            selectedOrder = userOrders.find(o => o.id === orderId);
            if(!selectedOrder) return;
            const p = products.find(prod => prod.id === selectedOrder.prodId) || {};
            
            document.getElementById('editOrderId').value = selectedOrder.id;
            document.getElementById('orderModalImg').src = p.img || '';
            document.getElementById('orderModalTitle').innerText = selectedOrder.prodName;
            document.getElementById('displayClientName').innerText = `Client: ${selectedOrder.client}`;
            document.getElementById('originCountry').innerText = p.origin || 'Origine';
            
            document.getElementById('valBase').innerText = (parseFloat(selectedOrder.price) || 0).toLocaleString();
            document.getElementById('valTransit').innerText = (parseFloat(selectedOrder.transit) || 0).toLocaleString();
            document.getElementById('valDouane').innerText = (parseFloat(selectedOrder.douane) || 0).toLocaleString();
            document.getElementById('valLivraison').innerText = (parseFloat(selectedOrder.livraison) || 0).toLocaleString();
            
            document.getElementById('paidBaseCheck').checked = selectedOrder.isPricePayed || false;
            document.getElementById('paidTransitCheck').checked = selectedOrder.isTransitPayed || false;
            document.getElementById('paidDouaneCheck').checked = selectedOrder.isDouanePayed || false;
            document.getElementById('paidLivraisonCheck').checked = selectedOrder.isLivraisonPayed || false;

            // Logistique
            document.getElementById('log_orig').checked = selectedOrder.logOrig || false;
            document.getElementById('log_ship').checked = selectedOrder.logShip || false;
            document.getElementById('log_transit').checked = selectedOrder.logTransit || false;
            document.getElementById('log_final').checked = selectedOrder.logFinal || false;
            document.getElementById('nextStepDate').value = selectedOrder.nextDate || '';

            this.updateStepStyle(document.getElementById('log_orig'));
            this.updateStepStyle(document.getElementById('log_ship'));
            this.updateStepStyle(document.getElementById('log_transit'));
            this.updateStepStyle(document.getElementById('log_final'));
            
            this.updateTotalDisplay();
            orderModalObj.show();
        },

        updateStepStyle(input) {
            const parent = input.closest('.logistics-step');
            if(input.checked) parent.classList.add('completed');
            else parent.classList.remove('completed');
        },

        updateTotalDisplay() {
            if(!selectedOrder) return;
            const total = (parseFloat(selectedOrder.price)||0) + (parseFloat(selectedOrder.transit)||0) + (parseFloat(selectedOrder.douane)||0) + (parseFloat(selectedOrder.livraison)||0);
            let payed = 0;
            if(document.getElementById('paidBaseCheck').checked) payed += parseFloat(selectedOrder.price)||0;
            if(document.getElementById('paidTransitCheck').checked) payed += parseFloat(selectedOrder.transit)||0;
            if(document.getElementById('paidDouaneCheck').checked) payed += parseFloat(selectedOrder.douane)||0;
            if(document.getElementById('paidLivraisonCheck').checked) payed += parseFloat(selectedOrder.livraison)||0;
            document.getElementById('orderTotalDisplay').innerText = `${(total - payed).toLocaleString()} F CFA`;
        },

        submitDirectOrder() {
            const orderId = document.getElementById('editOrderId').value;
            const idx = userOrders.findIndex(o => o.id === orderId);
            if(idx === -1) return;
            
            userOrders[idx].isPricePayed = document.getElementById('paidBaseCheck').checked;
            userOrders[idx].isTransitPayed = document.getElementById('paidTransitCheck').checked;
            userOrders[idx].isDouanePayed = document.getElementById('paidDouaneCheck').checked;
            userOrders[idx].isLivraisonPayed = document.getElementById('paidLivraisonCheck').checked;

            userOrders[idx].logOrig = document.getElementById('log_orig').checked;
            userOrders[idx].logShip = document.getElementById('log_ship').checked;
            userOrders[idx].logTransit = document.getElementById('log_transit').checked;
            userOrders[idx].logFinal = document.getElementById('log_final').checked;
            userOrders[idx].nextDate = document.getElementById('nextStepDate').value;
            
            localStorage.setItem(ORDERS_KEY, JSON.stringify(userOrders));
            this.renderOrders();
            orderModalObj.hide();
            alert("Donn√©es enregistr√©es !");
        },

        shareOrderWA() {
            if(!selectedOrder) return;
            const dateSuivi = document.getElementById('nextStepDate').value || '√Ä d√©finir';
            let msg = `üöö *SUIVI DE COMMANDE - ${document.getElementById('navCompanyName').innerText}*\n\n`;
            msg += `üë§ *Client :* ${selectedOrder.client}\n`;
            msg += `üì¶ *Produit :* ${selectedOrder.prodName}\n`;
            msg += `---------------------------\n`;
            msg += `üìà *LOGISTIQUE :*\n`;
            msg += `${document.getElementById('log_orig').checked ? '‚úÖ' : '‚è≥'} Achat/R√©ception\n`;
            msg += `${document.getElementById('log_ship').checked ? '‚úÖ' : '‚è≥'} Exp√©dition\n`;
            msg += `${document.getElementById('log_transit').checked ? '‚úÖ' : '‚è≥'} Transit/Douane\n`;
            msg += `${document.getElementById('log_final').checked ? '‚úÖ' : '‚è≥'} Livraison Pr√™te\n\n`;
            msg += `üìÖ *Prochaine √©tape pr√©vue :* ${dateSuivi}\n`;
            msg += `---------------------------\n`;
            msg += `üí∞ *RESTE √Ä PAYER :* ${document.getElementById('orderTotalDisplay').innerText}`;

            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        },

        openPublishModal() {
            document.getElementById('pubDate').innerText = `Le ${new Date().toLocaleDateString('fr-FR')}`;
            const container = document.getElementById('publishOrdersList');
            container.innerHTML = userOrders.map(o => {
                const total = (parseFloat(o.price)||0) + (parseFloat(o.transit)||0) + (parseFloat(o.douane)||0) + (parseFloat(o.livraison)||0);
                let payed = 0;
                if(o.isPricePayed) payed += parseFloat(o.price)||0;
                if(o.isTransitPayed) payed += parseFloat(o.transit)||0;
                if(o.isDouanePayed) payed += parseFloat(o.douane)||0;
                if(o.isLivraisonPayed) payed += parseFloat(o.livraison)||0;
                const status = (o.logFinal) ? "‚úÖ Pr√™t" : (o.logShip ? "üö¢ En Mer" : "üè≠ En cours");

                return `
                <div class="publish-item">
                    <h6 class="fw-bold mb-1 text-uppercase">${o.client} - ${o.prodName}</h6>
                    <div class="small">
                        üìç √âtat : <strong>${status}</strong><br>
                        üí∏ Reste : <span class="text-danger fw-bold">${(total-payed).toLocaleString()} F CFA</span>
                    </div>
                </div>`;
            }).join('');
            publishModalObj.show();
        },

        copyAndShareWhatsApp() {
            let text = `üì¢ *${document.getElementById('pubCompanyName').innerText} - POINT DES COMMANDES*\n\n`;
            userOrders.forEach(o => {
                const total = (parseFloat(o.price)||0) + (parseFloat(o.transit)||0) + (parseFloat(o.douane)||0) + (parseFloat(o.livraison)||0);
                let payed = 0;
                if(o.isPricePayed) payed += parseFloat(o.price)||0;
                if(o.isTransitPayed) payed += parseFloat(o.transit)||0;
                if(o.isDouanePayed) payed += parseFloat(o.douane)||0;
                if(o.isLivraisonPayed) payed += parseFloat(o.livraison)||0;
                const status = o.logFinal ? "PR√äT" : "EN COURS";
                text += `üë§ *${o.client}* | ${o.prodName}\nüìç Statut : ${status}\n‚ùå Reste : ${(total-payed).toLocaleString()} F\n\n`;
            });
            text += `\n‚úçÔ∏è *${document.getElementById('pubCEO').innerText}*`;
            navigator.clipboard.writeText(text).then(() => {
                alert("Copi√© ! Redirection WhatsApp...");
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            });
        }
    };

    window.onload = () => Shop.init();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="google-sheets-sync.js"></script>
</body>
</html>
